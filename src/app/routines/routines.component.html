<div class="routines-page">
  <!-- Hero Section -->
  <section class="hero-section py-5">
    <div class="container">
      <div class="row align-items-center">
        <div class="col-lg-8">
          <h1 class="display-5 fw-bold mb-3">
            <i class="fa-solid fa-calendar-days me-3"></i>
            {{ 'routines.title' | translate }}
          </h1>
          <p class="lead mb-0">
            {{ 'routines.subtitle' | translate }}
          </p>
        </div>
        <div class="col-lg-4">
          <div class="progress-card">
            <div class="progress-circle">
              <svg viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" class="progress-bg"></circle>
                <circle 
                  cx="50" cy="50" r="45" 
                  class="progress-bar"
                  [style.stroke-dashoffset]="283 - (283 * completionPercentage / 100)"
                ></circle>
              </svg>
              <div class="progress-text">
                <div class="percentage">{{ completionPercentage }}%</div>
                <div class="label">{{ 'routines.completed' | translate }}</div>
              </div>
            </div>
            <div class="progress-stats mt-3">
              <div class="stat">
                <i class="fa-solid fa-check-circle text-success"></i>
                <span>{{ dailyProgress().completedRoutines.length }} {{ 'routines.congratulations.routinesCompleted' | translate | lowercase }}</span>
              </div>
              <div class="stat">
                <i class="fa-solid fa-clock text-primary"></i>
                <span>{{ dailyProgress().totalMinutes }} {{ 'routines.congratulations.minutesDedicated' | translate | lowercase }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Filters Section -->
  <section class="filters-section py-4 bg-white border-bottom">
    <div class="container">
      <div class="d-flex gap-2 flex-wrap">
        <button 
          class="btn filter-btn"
          [class.active]="selectedCategory() === 'all'"
          (click)="setCategory('all')"
        >
          <i class="fa-solid fa-list me-2"></i>
          {{ 'routines.filters.all' | translate }}
        </button>
        <button 
          class="btn filter-btn"
          [class.active]="selectedCategory() === 'morning'"
          (click)="setCategory('morning')"
        >
          <i class="fa-solid fa-sun me-2"></i>
          {{ 'routines.filters.morning' | translate }}
        </button>
        <button 
          class="btn filter-btn"
          [class.active]="selectedCategory() === 'work'"
          (click)="setCategory('work')"
        >
          <i class="fa-solid fa-briefcase me-2"></i>
          {{ 'routines.filters.work' | translate }}
        </button>
        <button 
          class="btn filter-btn"
          [class.active]="selectedCategory() === 'evening'"
          (click)="setCategory('evening')"
        >
          <i class="fa-solid fa-moon me-2"></i>
          {{ 'routines.filters.evening' | translate }}
        </button>
        <button 
          class="btn filter-btn"
          [class.active]="selectedCategory() === 'anytime'"
          (click)="setCategory('anytime')"
        >
          <i class="fa-solid fa-infinity me-2"></i>
          {{ 'routines.filters.anytime' | translate }}
        </button>
      </div>
    </div>
  </section>

  <!-- Routines Grid -->
  <section class="py-5">
    <div class="container">
      <div class="row g-4">
        @for (routine of filteredRoutines; track routine.id) {
        <div class="col-md-6 col-lg-4">
          <div 
            class="routine-card"
            [class.completed]="isCompleted(routine.id)"
            (click)="openRoutineDetail(routine)"
          >
            @if (isCompleted(routine.id)) {
            <div class="completed-badge">
              <i class="fa-solid fa-check-circle"></i>
              {{ 'routines.completed' | translate }}
            </div>
            }
            
            <div class="routine-icon" [style.background-color]="getDifficultyColor(routine.difficulty)">
              <i class="fa-solid {{ routine.icon }}"></i>
            </div>
            
            <h5 class="routine-title">{{ routine.titleKey | translate }}</h5>
            <p class="routine-description">{{ routine.descriptionKey | translate }}</p>
            
            <div class="routine-meta">
              <span class="meta-item">
                <i class="fa-solid fa-clock"></i>
                {{ routine.duration }}
              </span>
              <span class="meta-item difficulty" [style.color]="getDifficultyColor(routine.difficulty)">
                <i class="fa-solid fa-signal"></i>
                {{ 'routines.difficulty.' + routine.difficulty | translate }}
              </span>
            </div>
            
            <div class="routine-category">
              <i class="fa-solid fa-tag me-1"></i>
              {{ 'routines.categories.' + routine.category | translate }}
            </div>
          </div>
        </div>
        }
      </div>

      @if (filteredRoutines.length === 0) {
      <div class="text-center py-5">
        <i class="fa-solid fa-inbox fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">No hay rutinas en esta categor√≠a</h5>
      </div>
      }
    </div>
  </section>

  <!-- Routine Detail Modal -->
  @if (showRoutineDetail() && selectedRoutine()) {
  <div class="modal-backdrop fade show" (click)="closeRoutineDetail()"></div>
  
  <div class="modal fade show d-block" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg" (click)="$event.stopPropagation()">
      <div class="modal-content">
        <div class="modal-header border-0">
          <div class="d-flex align-items-center gap-3">
            <div class="routine-icon-large" [style.background-color]="getDifficultyColor(selectedRoutine()!.difficulty)">
              <i class="fa-solid {{ selectedRoutine()!.icon }}"></i>
            </div>
            <div>
              <h4 class="modal-title mb-1">{{ selectedRoutine()!.titleKey | translate }}</h4>
              <div class="d-flex gap-3">
                <span class="badge bg-light text-dark">
                  <i class="fa-solid fa-clock me-1"></i>
                  {{ selectedRoutine()!.duration }}
                </span>
                <span class="badge" [style.background-color]="getDifficultyColor(selectedRoutine()!.difficulty)">
                  {{ 'routines.difficulty.' + selectedRoutine()!.difficulty | translate }}
                </span>
              </div>
            </div>
          </div>
          <button type="button" class="btn-close" (click)="closeRoutineDetail()"></button>
        </div>
        
        <div class="modal-body">
          <p class="lead text-muted mb-4">{{ selectedRoutine()!.descriptionKey | translate }}</p>
          
          <!-- Steps -->
          <div class="mb-4">
            <h5 class="mb-3">
              <i class="fa-solid fa-list-ol me-2 text-primary"></i>
              {{ 'routines.modal.steps' | translate }}
            </h5>
            <ol class="steps-list">
              @for (step of (selectedRoutine()!.stepsKey | translate); track $index) {
              <li class="step-item">{{ step }}</li>
              }
            </ol>
          </div>
          
          <!-- Benefits -->
          <div class="mb-4">
            <h5 class="mb-3">
              <i class="fa-solid fa-heart me-2 text-danger"></i>
              {{ 'routines.modal.benefits' | translate }}
            </h5>
            <ul class="benefits-list">
              @for (benefit of (selectedRoutine()!.benefitsKey | translate); track $index) {
              <li class="benefit-item">
                <i class="fa-solid fa-check-circle text-success me-2"></i>
                {{ benefit }}
              </li>
              }
            </ul>
          </div>
        </div>
        
        <div class="modal-footer border-0">
          @if (!isCompleted(selectedRoutine()!.id)) {
          <button 
            type="button" 
            class="btn btn-primary btn-lg w-100"
            (click)="markAsCompleted(selectedRoutine()!.id)"
          >
            <i class="fa-solid fa-check me-2"></i>
            {{ 'routines.modal.markComplete' | translate }}
          </button>
          } @else {
          <div class="d-flex gap-2 w-100">
            <div class="alert alert-success mb-0 flex-grow-1">
              <i class="fa-solid fa-check-circle me-2"></i>
              {{ 'routines.modal.alreadyCompleted' | translate }}
            </div>
            <button 
              type="button" 
              class="btn btn-outline-danger"
              (click)="cancelCompletion(selectedRoutine()!.id)"
              [title]="'routines.modal.cancelCompletion' | translate"
            >
              <i class="fa-solid fa-times"></i>
            </button>
          </div>
          }
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Congratulations Modal -->
  @if (showCongratulations()) {
  <div class="modal-backdrop fade show"></div>
  
  <div class="modal fade show d-block" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center congratulations-modal">
        <div class="modal-body py-5">
          <div class="celebration-icon mb-4">
            <i class="fa-solid fa-trophy"></i>
          </div>
          <h2 class="mb-3">{{ 'routines.congratulations.title' | translate }}</h2>
          <p class="lead mb-4">
            {{ 'routines.congratulations.message' | translate }}
          </p>
          <div class="stats-summary mb-4">
            <div class="stat-box">
              <i class="fa-solid fa-check-double text-success"></i>
              <div class="stat-number">{{ dailyProgress().completedRoutines.length }}</div>
              <div class="stat-label">{{ 'routines.congratulations.routinesCompleted' | translate }}</div>
            </div>
            <div class="stat-box">
              <i class="fa-solid fa-clock text-primary"></i>
              <div class="stat-number">{{ dailyProgress().totalMinutes }}</div>
              <div class="stat-label">{{ 'routines.congratulations.minutesDedicated' | translate }}</div>
            </div>
          </div>
          <p class="text-muted mb-4">
            {{ 'routines.congratulations.motivationalMessage' | translate }}
          </p>
          <div class="d-flex gap-2 justify-content-center">
            <button 
              type="button" 
              class="btn btn-primary btn-lg"
              (click)="closeCongratulations()"
            >
              <i class="fa-solid fa-check me-2"></i>
              {{ 'routines.congratulations.understood' | translate }}
            </button>
            <button 
              type="button" 
              class="btn btn-outline-secondary btn-lg"
              (click)="resetAllRoutines()"
            >
              <i class="fa-solid fa-rotate-right me-2"></i>
              {{ 'routines.congratulations.redoActivities' | translate }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
  }
</div>
